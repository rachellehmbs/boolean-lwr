% !TeX root = ../slides.tex
\begin{tikzpicture}[scale=1]
	
	\foreach \xshift in {0} 
	{
	\begin{scope}[xshift=\xshift cm]
		\foreach \y in {0, 1.5, 4.5}
		{
			%sbox
			\draw[thick, draw=oicyan ,fill=white,drop shadow] (0.5,\y) rectangle node[midway] {\huge \cyan{$S$}} +(1,1) ;
			
			%wires
			\foreach \smally in {1, 2, 3, 4} {
			\draw (0, \y + .2*\smally) -- +(.5, 0);
			\draw (1.5, \y + .2*\smally) -- +(.5, 0);
			\draw (3, \y + .2*\smally) -- +(.5, 0);
			
			\ifthenelse{\not{\equal{\xshift}{0}}}{	\draw (3.7, \y + .2*\smally) -- +(.5, 0);}{}
			
						%xors
			\draw[thick, draw=oired] (3.6,\y + .2*\smally) circle (0.1cm);
			\draw[thick, draw=oired] (3.6, \y + .2*\smally) -- +(0, 0.1)
			(3.6, \y + .2*\smally) -- +(0, -0.1)
			(3.6, \y + .2*\smally) -- +(-.1, 0)
			(3.6, \y + .2*\smally) -- +(.1, 0);
			
			}


		}
		\draw[draw=white] (0.5,3) rectangle node[midway] {\huge \cyan{$\vdots$}} +(1,1) ;
		
		\draw[thick, draw=oiorange ,fill=white,drop shadow] (2,0) rectangle node[midway] {\huge \orange{$L$}} +(1,5.5) ;
		
	\end{scope}
	
	% \foreach \y in {0, 1.5, 4.5, 6}
	% {
	% 	\foreach \smally in {1, 2, 3, 4} {
	% 	\draw[dashed] (8, \y + .2*\smally) -- +(3, 0);
	% 	}
	% }
		% \draw[draw=white] (9, 3) -- node[midway] {$\cdots$} +(1, 1);
}

\iftoggle{SPNtwoS}{
\begin{scope}[xshift=3.5 cm]
		\foreach \y in {0, 1.5, 4.5}
		{
			%sbox
			\draw[thick, draw=oicyan ,fill=white,drop shadow] (0.5,\y) rectangle node[midway] {\huge \cyan{$S$}} +(1,1) ;
			
			%wires
			\foreach \smally in {1, 2, 3, 4} {
			\draw (0, \y + .2*\smally) -- +(.5, 0);
			\draw (1.5, \y + .2*\smally) -- +(.5, 0);
			}
		}
		\draw[draw=white] (0.5,3) rectangle node[midway] {\huge \cyan{$\vdots$}} +(1,1) ;		
	\end{scope} }{}
	% \draw[draw=oired, thick,decorate,decoration={brace, amplitude=10pt}] (4.1, -.2) -- node[midway, below=.3cm] {\red{Round $0$}} +(-3.8, 0);
	% \draw[draw=oired, thick,decorate,decoration={brace, amplitude=10pt}] (8, -.2) -- node[midway, below=.3cm] {\red{Round $1$}} +(-3.8, 0);
	% \draw[draw=oired, thick,decorate,decoration={brace, amplitude=10pt}] (15, -.2) -- node[midway, below=.3cm] {\red{Round $R-1$}} +(-3.8, 0);
	
	\draw[draw=oicyan, thick,decorate,decoration={brace, amplitude=10pt}] (0.5, 5.6) -- node[midway, above=.3cm] {\cyan{Sbox layer}} +(1, 0);
	\draw[draw=oiorange, thick,decorate,decoration={brace, amplitude=10pt}] (3, -.2) -- node[midway, below=.3cm] {\orange{Linear layer}} +(-1, 0);
	\draw[draw=oired, thick,decorate,decoration={brace, amplitude=5pt}] (3.3, 5.6) -- node[midway, above=.3cm] {\red{Key addition}} +(.6, 0);

	\iftoggle{SPNaccolade}{
	\draw[draw=oigray, thick,decorate,decoration={brace, amplitude=10pt}] (4, -1) -- node[midway, below=.3cm] {\huge $\gray{F}_{\red{k^{(i)}}} = \gray{T}_{\red{k^{(i)}}} \comp \orange{L} \comp \cyan{\sboxlayer} $} +(-4, 0);
	}{}

\end{tikzpicture}
