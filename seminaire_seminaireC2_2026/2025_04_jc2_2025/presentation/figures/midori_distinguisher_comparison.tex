

%% Document
\begin{tikzpicture}[scale=0.1]
  \everymath{\scriptstyle}

  \tikzset{edge/.style=-latex new, arrow head=6pt, thick};

  %% Plaintext
  \begin{scope}[yshift=19cm]

    \begin{scope}[xshift=3.5cm]
    
    	\foreach \x in {0,...,3}
    	{ \foreach \y in {0,...,3}
    		{\fill[color=cblue] 	(\x,\y) rectangle +(1,1);}
   		}
	  
      \draw (0,0) rectangle (4,4);
      \draw (0,1) -- +(4,0);
      \draw (0,2) -- +(4,0);
      \draw (0,3) -- +(4,0);
      \draw (1,0) -- +(0,4);
      \draw (2,0) -- +(0,4);
      \draw (3,0) -- +(0,4);
      \path (-2.5,2) node {$\Delta_{IN}$};

      \draw (2,0) -- ++(0,-3.4);
    \end{scope}
  \end{scope}


  %% Round 0
  \begin{scope}[yshift=14cm]

    \draw (5.5,2) circle (0.3);
    \draw[edge] (1,0) -- node[left] {\tiny KS} ++(0,-3);

    \begin{scope}[xshift=-1cm]
   	

      \draw (0,0) rectangle (4,4);
      \draw (0,1) -- +(4,0);
      \draw (0,2) -- +(4,0);
      \draw (0,3) -- +(4,0);
      \draw (1,0) -- +(0,4);
      \draw (2,0) -- +(0,4);
      \draw (3,0) -- +(0,4);
      \path (-2,2) node {$k_0$};
      
      \draw[edge] (4,2) -- node[below] {\tiny AK} +(5,0);
    \end{scope}

    \begin{scope}[xshift=8cm]
    	
    	
\foreach \x in {0,...,3}
{ \foreach \y in {0,...,3}
{\fill[color=cred] 	(\x,\y) rectangle +(1,1);}
}

      \draw (0,0) rectangle (4,4);
      \draw (0,1) -- +(4,0);
      \draw (0,2) -- +(4,0);
      \draw (0,3) -- +(4,0);
      \draw (1,0) -- +(0,4);
      \draw (2,0) -- +(0,4);
      \draw (3,0) -- +(0,4);
%      \path (2,4.5) node {\scriptsize$x_0$};
      
      \draw[edge] (4,2) -- node[above] {\tiny SB} +(4,0);
    \end{scope}


    \begin{scope}[xshift=16cm]
    
	\foreach \x in {0,...,3}
	{ \foreach \y in {0,...,3}
		{\fill[color=cred] 	(\x,\y) rectangle +(1,1);}
	}


      \draw (0,0) rectangle (4,4);
      \draw (0,1) -- +(4,0);
      \draw (0,2) -- +(4,0);
      \draw (0,3) -- +(4,0);
      \draw (1,0) -- +(0,4);
      \draw (2,0) -- +(0,4);
      \draw (3,0) -- +(0,4);
%      \path (2,4.5) node {\scriptsize$y_0$};
      
      \draw[edge] (4,2) -- node[above] {\tiny SR} +(4,0);
    \end{scope}


    \begin{scope}[xshift=24cm]
\foreach \x in {0,...,3}
{ \foreach \y in {0,...,3}
	{\fill[color=cred] 	(\x,\y) rectangle +(1,1);}
}

      \draw (0,0) rectangle (4,4);
      \draw (0,1) -- +(4,0);
      \draw (0,2) -- +(4,0);
      \draw (0,3) -- +(4,0);
      \draw (1,0) -- +(0,4);
      \draw (2,0) -- +(0,4);
      \draw (3,0) -- +(0,4);
%      \path (2,4.5) node {\scriptsize$z_0$};
      
      \draw[edge] (4,2) -- node[above] {\tiny MC} +(4,0);
    \end{scope}


    \begin{scope}[xshift=32cm]
\foreach \x in {0,...,3}
{ \foreach \y in {0,...,3}
	{\fill[color=cred] 	(\x,\y) rectangle +(1,1);}
}


      \draw (0,0) rectangle (4,4);
      \draw (0,1) -- +(4,0);
      \draw (0,2) -- +(4,0);
      \draw (0,3) -- +(4,0);
      \draw (1,0) -- +(0,4);
      \draw (2,0) -- +(0,4);
      \draw (3,0) -- +(0,4);
%      \path (2,4.5) node {\scriptsize$w_0$};
      
      \draw (4,2) -- ++(2,0) -- ++(0,-3.5) -- ++(-32.5,0) -- ++(0,-3.9);
      \path (11,2) node {\scriptsize Round 0};
    \end{scope}
  \end{scope}


  %% Round 1
  \begin{scope}[yshift=7cm]

    \draw (5.5,2) circle (0.3);
    \draw[edge] (1,0) -- node[left] {\tiny KS} ++(0,-3);

    \begin{scope}[xshift=-1cm]
        

      \draw (0,0) rectangle (4,4);
      \draw (0,1) -- +(4,0);
      \draw (0,2) -- +(4,0);
      \draw (0,3) -- +(4,0);
      \draw (1,0) -- +(0,4);
      \draw (2,0) -- +(0,4);
      \draw (3,0) -- +(0,4);
      \path (-2,2) node {$k_1$};
      
      \draw[edge] (4,2) -- node[below] {\tiny AK} +(5,0);
    \end{scope}

    \begin{scope}[xshift=8cm]
\foreach \x in {0,...,3}
{ \foreach \y in {0,...,3}
	{\fill[color=cred] 	(\x,\y) rectangle +(1,1);}
}
      \draw (0,0) rectangle (4,4);
      \draw (0,1) -- +(4,0);
      \draw (0,2) -- +(4,0);
      \draw (0,3) -- +(4,0);
      \draw (1,0) -- +(0,4);
      \draw (2,0) -- +(0,4);
      \draw (3,0) -- +(0,4);
%      \path (2,4.5) node {\scriptsize$x_1$};
      
      \draw[edge] (4,2) -- node[above] {\tiny SB} +(4,0);
    \end{scope}


    \begin{scope}[xshift=16cm]
\foreach \x in {0,...,3}
{ \foreach \y in {0,...,3}
	{\fill[color=cred] 	(\x,\y) rectangle +(1,1);}
}

      \draw (0,0) rectangle (4,4);
      \draw (0,1) -- +(4,0);
      \draw (0,2) -- +(4,0);
      \draw (0,3) -- +(4,0);
      \draw (1,0) -- +(0,4);
      \draw (2,0) -- +(0,4);
      \draw (3,0) -- +(0,4);
%      \path (2,4.5) node {\scriptsize$y_1$};
      
      \draw[edge] (4,2) -- node[above] {\tiny SR} +(4,0);
    \end{scope}


    \begin{scope}[xshift=24cm]
\foreach \x in {0,...,3}
{ \foreach \y in {0,...,3}
	{\fill[color=cred] 	(\x,\y) rectangle +(1,1);}
}
      \draw (0,0) rectangle (4,4);
      \draw (0,1) -- +(4,0);
      \draw (0,2) -- +(4,0);
      \draw (0,3) -- +(4,0);
      \draw (1,0) -- +(0,4);
      \draw (2,0) -- +(0,4);
      \draw (3,0) -- +(0,4);
%      \path (2,4.5) node {\scriptsize$z_1$};
      %\path (2,  -1) node {$S_{start}$};
      
      \draw[edge] (4,2) -- node[above] {\tiny MC} +(4,0);
    \end{scope}


    \begin{scope}[xshift=32cm]
\foreach \x in {0,...,3}
{ \foreach \y in {0,...,3}
	{\fill[color=cred] 	(\x,\y) rectangle +(1,1);}
}
      \draw (0,0) rectangle (4,4);
      \draw (0,1) -- +(4,0);
      \draw (0,2) -- +(4,0);
      \draw (0,3) -- +(4,0);
      \draw (1,0) -- +(0,4);
      \draw (2,0) -- +(0,4);
      \draw (3,0) -- +(0,4);
%      \path (2,4.5) node {\scriptsize$w_1$};
      %\path (2,  -1) node {$S'_{start}$};
      
      \draw (4,2) -- ++(2,0) -- ++(0,-3.9) -- ++(-32.5,0) -- ++(0,-3.5);
      \path (11,2) node {\scriptsize Round 1};
    \end{scope}
  \end{scope}


  %% Round 2
  \begin{scope}[yshift=0cm]
    \draw (5.5,2) circle (0.3);
    \draw[edge] (1,0) -- node[left] {\tiny KS} ++(0,-3);

    \begin{scope}[xshift=-1cm]
        

      \draw (0,0) rectangle (4,4);
      \draw (0,1) -- +(4,0);
      \draw (0,2) -- +(4,0);
      \draw (0,3) -- +(4,0);
      \draw (1,0) -- +(0,4);
      \draw (2,0) -- +(0,4);
      \draw (3,0) -- +(0,4);
      \path (-2,2) node {$k_2$};
      
      \draw[edge] (4,2) -- node[below] {\tiny AK} +(5,0);
    \end{scope}
    
  \begin{scope}[xshift=8cm]
\foreach \x in {0,...,3}
{ \foreach \y in {0,...,3}
	{\fill[color=cred] 	(\x,\y) rectangle +(1,1);}
}
    \draw (0,0) rectangle (4,4);
    \draw (0,1) -- +(4,0);
    \draw (0,2) -- +(4,0);
    \draw (0,3) -- +(4,0);
    \draw (1,0) -- +(0,4);
    \draw (2,0) -- +(0,4);
    \draw (3,0) -- +(0,4);
  %  \path (2,4.5) node {\scriptsize$x_2$};
    
    \draw[edge] (4,2) -- node[above] {\tiny SB} +(4,0);
  \end{scope}


  \begin{scope}[xshift=16cm]
\foreach \x in {0,...,3}
{ \foreach \y in {0,...,3}
	{\fill[color=cred] 	(\x,\y) rectangle +(1,1);}
}
    \draw (0,0) rectangle (4,4);
    \draw (0,1) -- +(4,0);
    \draw (0,2) -- +(4,0);
    \draw (0,3) -- +(4,0);
    \draw (1,0) -- +(0,4);
    \draw (2,0) -- +(0,4);
    \draw (3,0) -- +(0,4);
   % \path (2,4.5) node {\scriptsize$y_2$};
    
    \draw[edge] (4,2) -- node[above] {\tiny SR} +(4,0);
  \end{scope}


  \begin{scope}[xshift=24cm]
\foreach \x in {0,...,3}
{ \foreach \y in {0,...,3}
	{\fill[color=cred] 	(\x,\y) rectangle +(1,1);}
}
    
    \draw (0,0) rectangle (4,4);
    \draw (0,1) -- +(4,0);
    \draw (0,2) -- +(4,0);
    \draw (0,3) -- +(4,0);
    \draw (1,0) -- +(0,4);
    \draw (2,0) -- +(0,4);
    \draw (3,0) -- +(0,4);
  %  \path (2,4.5) node {\scriptsize$z_2$};
    
    \draw[edge] (4,2) -- node[above] {\tiny MC} +(4,0);
  \end{scope}


  \begin{scope}[xshift=32cm]
\foreach \x in {0,...,3}
{ \foreach \y in {0,...,3}
	{\fill[color=cred] 	(\x,\y) rectangle +(1,1);}
}

    \draw (0,0) rectangle (4,4);
    \draw (0,1) -- +(4,0);
    \draw (0,2) -- +(4,0);
    \draw (0,3) -- +(4,0);
    \draw (1,0) -- +(0,4);
    \draw (2,0) -- +(0,4);
    \draw (3,0) -- +(0,4);
  %  \path (2,4.5) node {\scriptsize$w_2$};
    
    \draw (4,2) -- ++(2,0) -- ++(0,-3.5) -- ++(-32.5,0) -- ++(0,-3.9);
    \path (11,2) node {\scriptsize Round 2};
  \end{scope}
  \end{scope}

  %% Round 3
  \begin{scope}[yshift=-7cm]

    \draw (5.5,2) circle (0.3);
    \draw[edge] (1,0) -- node[left] {\tiny KS} ++(0,-3);

    \begin{scope}[xshift=-1cm]


      \draw (0,0) rectangle (4,4);
      \draw (0,1) -- +(4,0);
      \draw (0,2) -- +(4,0);
      \draw (0,3) -- +(4,0);
      \draw (1,0) -- +(0,4);
      \draw (2,0) -- +(0,4);
      \draw (3,0) -- +(0,4);
      \path (-2,2) node {$k_3$};
      
      \draw[edge] (4,2) -- node[below] {\tiny AK} +(5,0);
    \end{scope}

    \begin{scope}[xshift=8cm]	
\foreach \x in {0,...,3}
{ \foreach \y in {0,...,3}
	{\fill[color=cred] 	(\x,\y) rectangle +(1,1);}
}
      \draw (0,0) rectangle (4,4);
      \draw (0,1) -- +(4,0);
      \draw (0,2) -- +(4,0);
      \draw (0,3) -- +(4,0);
      \draw (1,0) -- +(0,4);
      \draw (2,0) -- +(0,4);
      \draw (3,0) -- +(0,4);
%      \path (2,4.5) node {\scriptsize$x_3$};
      
      \draw[edge] (4,2) -- node[above] {\tiny SB} +(4,0);
    \end{scope}


    \begin{scope}[xshift=16cm]
\foreach \x in {0,...,3}
{ \foreach \y in {0,...,3}
	{\fill[color=cred] 	(\x,\y) rectangle +(1,1);}
}

      \draw (0,0) rectangle (4,4);
      \draw (0,1) -- +(4,0);
      \draw (0,2) -- +(4,0);
      \draw (0,3) -- +(4,0);
      \draw (1,0) -- +(0,4);
      \draw (2,0) -- +(0,4);
      \draw (3,0) -- +(0,4);
%      \path (2,4.5) node {\scriptsize$y_3$};
      
      \draw[edge] (4,2) -- node[above] {\tiny SR} +(4,0);
    \end{scope}


    \begin{scope}[xshift=24cm]
\foreach \x in {0,...,3}
{ \foreach \y in {0,...,3}
	{\fill[color=cred] 	(\x,\y) rectangle +(1,1);}
}

      \draw (0,0) rectangle (4,4);
      \draw (0,1) -- +(4,0);
      \draw (0,2) -- +(4,0);
      \draw (0,3) -- +(4,0);
      \draw (1,0) -- +(0,4);
      \draw (2,0) -- +(0,4);
      \draw (3,0) -- +(0,4);
%      \path (2,4.5) node {\scriptsize$z_3$};
      %\path (2,-1) node {$S_{end}$};
      
      \draw[edge] (4,2) -- node[above] {\tiny MC} +(4,0);
    \end{scope}


    \begin{scope}[xshift=32cm]
\foreach \x in {0,...,3}
{ \foreach \y in {0,...,3}
	{\fill[color=cred] 	(\x,\y) rectangle +(1,1);}
}

      \draw (0,0) rectangle (4,4);
      \draw (0,1) -- +(4,0);
      \draw (0,2) -- +(4,0);
      \draw (0,3) -- +(4,0);
      \draw (1,0) -- +(0,4);
      \draw (2,0) -- +(0,4);
      \draw (3,0) -- +(0,4);
%      \path (2,4.5) node {\scriptsize$w_3$};
      
      \draw (4,2) -- ++(2,0) -- ++(0,-3.9) -- ++(-32.5,0) -- ++(0,-3.5);
      \path (11,2) node {\scriptsize Round 3};
    \end{scope}
  \end{scope}

  %% Round 4
  \begin{scope}[yshift=-14cm]

    \draw (5.5,2) circle (0.3);
    %\draw[edge] (1,0) -- node[left] {\tiny KS} ++(0,-3);

    \begin{scope}[xshift=-1cm]


      \draw (0,0) rectangle (4,4);
      \draw (0,1) -- +(4,0);
      \draw (0,2) -- +(4,0);
      \draw (0,3) -- +(4,0);
      \draw (1,0) -- +(0,4);
      \draw (2,0) -- +(0,4);
      \draw (3,0) -- +(0,4);
      \path (-2,2) node {$k_4$};
      
      \draw[edge] (4,2) -- node[below] {\tiny AK} +(5,0);
    \end{scope}

    \begin{scope}[xshift=8cm]
\foreach \x in {0,...,3}
{ \foreach \y in {0,...,3}
	{\fill[color=cred] 	(\x,\y) rectangle +(1,1);}
}

      \draw (0,0) rectangle (4,4);
      \draw (0,1) -- +(4,0);
      \draw (0,2) -- +(4,0);
      \draw (0,3) -- +(4,0);
      \draw (1,0) -- +(0,4);
      \draw (2,0) -- +(0,4);
      \draw (3,0) -- +(0,4);
%      \path (2,4.5) node {\scriptsize$x_4$};
      
      \draw[edge] (4,2) -- node[above] {\tiny SB} +(4,0);
    \end{scope}


    \begin{scope}[xshift=16cm]
\foreach \x in {0,...,3}
{ \foreach \y in {0,...,3}
	{\fill[color=cred] 	(\x,\y) rectangle +(1,1);}
}

      \draw (0,0) rectangle (4,4);
      \draw (0,1) -- +(4,0);
      \draw (0,2) -- +(4,0);
      \draw (0,3) -- +(4,0);
      \draw (1,0) -- +(0,4);
      \draw (2,0) -- +(0,4);
      \draw (3,0) -- +(0,4);
%      \path (2,4.5) node {\scriptsize$y_4$};
      
      \draw[edge] (4,2) -- node[above] {\tiny SR} +(4,0);
    \end{scope}


    \begin{scope}[xshift=24cm]
\foreach \x in {0,...,3}
{ \foreach \y in {0,...,3}
	{\fill[color=cred] 	(\x,\y) rectangle +(1,1);}
}

      \draw (0,0) rectangle (4,4);
      \draw (0,1) -- +(4,0);
      \draw (0,2) -- +(4,0);
      \draw (0,3) -- +(4,0);
      \draw (1,0) -- +(0,4);
      \draw (2,0) -- +(0,4);
      \draw (3,0) -- +(0,4);
%      \path (2,4.5) node {\scriptsize$z_4$};
      
      \draw[edge] (4,2) -- node[above] {\tiny MC} +(4,0);
    \end{scope}


    \begin{scope}[xshift=32cm]
\foreach \x in {0,...,3}
{ \foreach \y in {0,...,3}
	{\fill[color=cred] 	(\x,\y) rectangle +(1,1);}
}

      \draw (0,0) rectangle (4,4);
      \draw (0,1) -- +(4,0);
      \draw (0,2) -- +(4,0);
      \draw (0,3) -- +(4,0);
      \draw (1,0) -- +(0,4);
      \draw (2,0) -- +(0,4);
      \draw (3,0) -- +(0,4);
%      \path (2,4.5) node {\scriptsize$w_4$};
      
      %\draw (4,2) -- ++(2,0) -- ++(0,-3.5) -- ++(-32.5,0) -- ++(0,-3.9);
      \path (11,2) node {\scriptsize Round 4};
    \end{scope}
  \end{scope}

 
\begin{scope}[yshift=-19cm]

            % blue 0x8E
            \draw[fill=cblue]  (0,0) rectangle ++(1,1);
            \path (4.4,0.5) node {\scriptsize\tt 0xf};

            % red 0x7A
            \draw[fill=cred]  (0,-2) rectangle ++(1,1);
            \path (8.4,0.5-2) node {\scriptsize\tt 0xf or \tt 0xa};

            % WHITE No Difference
            \draw[draw=black]  (0,-4) rectangle ++(1,1);
            \path (7,0.5-4) node {\tt \scriptsize No diff.};

\end{scope}

\end{tikzpicture}



